























































<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Add Product</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<body class="bg-[#002d6e] p-8">

    <!-- Navigation Bar -->
    <header class="bg-[#002d6e] py-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center px-6">

            <!-- Logo & Website Name -->
            <div class="flex items-center space-x-3">
                <img src="../imageAssets/Screenshot 2025-01-12 103506.png" alt="FURNICS Logo" class="h-14"> 
                <span class="text-3xl font-bold text-white">FURNICS</span>
            </div>

            <!-- Navigation Links
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="#" class="text-white hover:text-[#ff8000] text-lg transition">Home</a></li>
                    <li><a href="#" class="text-white hover:text-[#ff8000] text-lg transition">Shop</a></li>
                    <li><a href="#" class="text-white hover:text-[#ff8000] text-lg transition">About</a></li>
                    <li><a href="#" class="text-white hover:text-[#ff8000] text-lg transition">Contact</a></li>
                </ul>
            </nav> -->

            <!-- Button & Icons -->
            <div class="flex items-center space-x-6">
                <a href="/adminOrderHistory" class="bg-[#ff8000] text-white px-5 py-2 rounded-md font-semibold hover:bg-[#e67300] transition">
                    Orders
                </a>
                <!-- <a href="#" class="text-white text-2xl hover:text-[#ff8000] transition" title="Order History">
                    <i class="fa-solid fa-box"></i>
                </a>
                <a href="#" class="text-white text-2xl hover:text-[#ff8000] transition" title="Cart">
                    <i class="fa-solid fa-shopping-cart"></i>
                </a> -->
                <a href="/userProfile" class="text-white text-2xl hover:text-[#ff8000] transition" title="Profile">
                    <i class="fa-solid fa-user"></i>
                </a>
            </div>

        </div>
    </header>

    <div class="max-w-3xl mx-auto bg-white p-6 rounded-lg shadow-lg border border-gray-200">
        <h2 class="text-3xl font-bold text-[#002d6e] mb-4">Add Product</h2>

        <form id="productForm">
            <label class="block text-[#002d6e] font-semibold mb-1">Product Category:</label>
            <select id="category" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" required>
                <option value="" disabled selected>Select Category</option>
                <option value="Wardrobe">Wardrobe</option>
                <option value="Bed">Bed</option>
                <option value="Office Chair">Office Chair</option>
                <option value="Sofa">Sofa</option>
                <option value="Shoe Rack">Shoe Rack</option>
                <option value="Study Table">Study Table</option>
            </select>

            <label class="block text-[#002d6e] font-semibold mt-3 mb-1">Product Name:</label>
            <input type="text" id="name" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]"
                required>

            <h3 class="text-lg font-semibold text-[#002d6e] mt-4">Product Features</h3>
            <div id="featuresContainer"></div>
            <button type="button" onclick="addFeature()"
                class="bg-[#002d6e] text-white px-4 py-2 mt-2 rounded-md hover:bg-[#ff8000] transition duration-300">+
                Add Feature</button>

            <h3 class="text-lg font-semibold text-[#002d6e] mt-4">Product Images</h3>
            <div id="imagesContainer"></div>
            <button type="button" onclick="addImage()"
                class="bg-[#002d6e] text-white px-4 py-2 mt-2 rounded-md hover:bg-[#ff8000] transition duration-300">+
                Add Image URL</button>

            <h3 class="text-lg font-semibold text-[#002d6e] mt-4">Product Variants</h3>
            <div id="variantsContainer"></div>
            <button type="button" onclick="addVariant()"
                class="bg-[#002d6e] text-white px-4 py-2 mt-2 rounded-md hover:bg-[#ff8000] transition duration-300">+
                Add Variant</button>

            <button type="submit"
                class="block w-full bg-[#ff8000] text-white px-4 py-2 mt-4 rounded-md hover:bg-[#002d6e] transition duration-300">Submit
                Product</button>
        </form>

    </div>

    <div class="max-w-6xl mx-auto mt-8">
        <h2 class="text-3xl font-bold text-[#002d6e] mb-4">All Products</h2>
        <div class="bg-white rounded-lg shadow-lg border border-gray-200 overflow-x-auto">
            <table class="min-w-full">
                <thead class="bg-[#002d6e] text-white">
                    <tr>
                        <th class="p-3">Product ID</th>
                        <th class="p-3">Product Name</th>
                        <th class="p-3">Image</th>
                        <th class="p-3">Variants</th>
                        <th class="p-3">Actions</th>
                    </tr>
                </thead>
                <tbody id="productTable" class="divide-y divide-gray-200">

                </tbody>
            </table>
        </div>
    </div>

    <script>
        function addFeature() {
            let container = document.getElementById("featuresContainer");
            let div = document.createElement("div");
            div.classList.add("flex", "space-x-2", "mt-2");

            div.innerHTML = `
                <input type="text" class="feature w-5/6 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" placeholder="Enter feature">
                <button type="button" onclick="removeElement(this)" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">X</button>
            `;
            container.appendChild(div);
        }

        function addImage() {
            let container = document.getElementById("imagesContainer");
            let div = document.createElement("div");
            div.classList.add("flex", "space-x-2", "mt-2");

            div.innerHTML = `
                <input type="text" class="image-url w-5/6 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" placeholder="Enter image URL">
                <button type="button" onclick="removeElement(this)" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">X</button>
            `;
            container.appendChild(div);
        }

        function addVariant() {
            let container = document.getElementById("variantsContainer");
            let div = document.createElement("div");
            div.classList.add("flex", "space-x-2", "mt-2");

            div.innerHTML = `
                <input type="text" class="variant-size w-1/3 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" placeholder="Size (e.g., 5x6x5)">
                <input type="number" class="variant-price w-1/3 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" placeholder="Price">
                <input type="number" class="variant-quantity w-1/3 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" placeholder="Quantity">
                <button type="button" onclick="removeElement(this)" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">X</button>
            `;
            container.appendChild(div);
        }

        function removeElement(btn) {
            btn.parentElement.remove();
        }

        document.getElementById("productForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            let category = document.getElementById("category").value;
            let name = document.getElementById("name").value;

            let features = [];
            document.querySelectorAll("#featuresContainer .feature").forEach(input => {
                if (input.value.trim() !== "") {
                    features.push(input.value.trim());
                }
            });

            let images = [];
            document.querySelectorAll("#imagesContainer .image-url").forEach(input => {
                if (input.value.trim() !== "") {
                    images.push(input.value.trim());
                }
            });

            let variants = [];
            document.querySelectorAll("#variantsContainer div").forEach(div => {
                let size = div.querySelector(".variant-size").value;
                let price = div.querySelector(".variant-price").value;
                let quantity = div.querySelector(".variant-quantity").value;

                if (size && price && quantity) {
                    variants.push({
                        size,
                        price: parseFloat(price),
                        quantity: parseInt(quantity)
                    });
                }
            });

            let productData = { category, name, features, images, variants };

            let editingProductId = document.getElementById("productForm").dataset.editingProductId;

            if (editingProductId) {
                // Update existing product
                let response = await fetch(`/update-product/${editingProductId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(productData)
                });

                let result = await response.json();
                alert(result.message);
                delete document.getElementById("productForm").dataset.editingProductId;  // Remove editing ID
                document.querySelector("#productForm button[type='submit']").textContent = "Submit Product"; // Reset button text
            } else {
                // Add new product
                let response = await fetch("/add-product", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(productData)
                });

                let result = await response.json();
                alert(result.message);
            }

            loadProducts();  // Refresh product list
            document.getElementById("productForm").reset();  // Clear the form
        });

        // Load products when page loads
        document.addEventListener('DOMContentLoaded', loadProducts);

        async function loadProducts() {
            try {
                const response = await fetch('/products/all');
                const products = await response.json();

                const tbody = document.getElementById('productTable');
                tbody.innerHTML = '';

                products.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td class="p-3 text-center">${product.productId}</td>
                <td class="p-3 text-center">${product.name}</td>
                <td class="p-3 text-center">
                    ${product.images.length > 0 ?
                            `<img src="${product.images[0]}" class="w-20 h-20 object-cover mx-auto">` :
                            'No Image'}
                </td>
                <td class="p-3 text-center">
                    ${product.variants.map(v => `Size: ${v.size}<br>Price: ₹${v.price}`).join('<br>')}
                </td>
                <td class="p-3 text-center space-x-2">
                    <button onclick="editProduct('${product._id}')" class="bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-700">Edit</button>
                    <button onclick="deleteProduct('${product._id}')" class="bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-700">Delete</button>
                </td>
            `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // async function deleteProduct(productId) {
        //     if (confirm('Are you sure you want to delete this product?')) {
        //         try {
        //             const response = await fetch(`/product/${productId}`, {
        //                 method: 'DELETE'
        //             });
        //             const result = await response.json();
        //             alert(result.message);
        //             loadProducts(); // Refresh the table
        //         } catch (error) {
        //             console.error('Error deleting product:', error);
        //         }
        //     }
        // }


        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const response = await fetch(`/delete-product/${productId}`, {  // ✅ Fixed URL
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    alert(result.message);
                    fetchProducts(); // ✅ Ensure correct function name
                } catch (error) {
                    console.error('Error deleting product:', error);
                }
            }
        }

        async function editProduct(productId) {
            try {
                const response = await fetch(`/product/${productId}`);
                const product = await response.json();

                // Populate the form fields with the product data
                document.getElementById("category").value = product.category;
                document.getElementById("name").value = product.name;

                // Populate features
                const featuresContainer = document.getElementById("featuresContainer");
                featuresContainer.innerHTML = "";
                product.features.forEach(feature => {
                    let div = document.createElement("div");
                    div.classList.add("flex", "space-x-2", "mt-2");
                    div.innerHTML = `
                <input type="text" class="feature w-5/6 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" value="${feature}">
                <button type="button" onclick="removeElement(this)" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">X</button>
            `;
                    featuresContainer.appendChild(div);
                });

                // Populate images
                const imagesContainer = document.getElementById("imagesContainer");
                imagesContainer.innerHTML = "";
                product.images.forEach(image => {
                    let div = document.createElement("div");
                    div.classList.add("flex", "space-x-2", "mt-2");
                    div.innerHTML = `
                <input type="text" class="image-url w-5/6 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" value="${image}">
                <button type="button" onclick="removeElement(this)" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">X</button>
            `;
                    imagesContainer.appendChild(div);
                });

                // Populate variants
                const variantsContainer = document.getElementById("variantsContainer");
                variantsContainer.innerHTML = "";
                product.variants.forEach(variant => {
                    let div = document.createElement("div");
                    div.classList.add("flex", "space-x-2", "mt-2");
                    div.innerHTML = `
                <input type="text" class="variant-size w-1/3 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" value="${variant.size}">
                <input type="number" class="variant-price w-1/3 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" value="${variant.price}">
                <input type="number" class="variant-quantity w-1/3 p-2 border rounded-md focus:ring-2 focus:ring-[#ff8000]" value="${variant.quantity}">
                <button type="button" onclick="removeElement(this)" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">X</button>
            `;
                    variantsContainer.appendChild(div);
                });

                // Store product ID for updating
                document.getElementById("productForm").dataset.editingProductId = productId;

                // Change button text
                document.querySelector("#productForm button[type='submit']").textContent = "Update Product";

            } catch (error) {
                console.error("Error fetching product:", error);
            }
        }


        // Add this inside your form submit event handler after successful submission:
        // alert(result.message);
        // loadProducts(); // Add this line to refresh the table after adding a product
    </script>
</body>

</html>